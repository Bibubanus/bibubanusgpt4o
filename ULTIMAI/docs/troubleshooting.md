# Troubleshooting Guide

This document covers common issues encountered when working with the ULTIMAI reasoning infrastructure and provides guidance on how to resolve them.  If you run into an unexpected error while running tests, building graphs or generating reports, consult the sections below.

## Module import errors

### `ModuleNotFoundError: No module named 'ultimai'`

The CLI scripts under `scripts/` import the `ultimai` package.  When running these scripts directly, Python may not know where to find the package.  To resolve this, set the `PYTHONPATH` environment variable to include the project root (e.g. `ULTIMAI`) when invoking the script:

```bash
PYTHONPATH=ULTIMAI python ULTIMAI/scripts/generate_graph.py --input ULTIMAI/data/seeds.json --output build/graph/graph.json
```

Alternatively, use the provided Makefile targets (`make build_graph`, `make report`) which already set `PYTHONPATH` for you.

## Missing dependencies

The core of the reasoning infrastructure has no mandatory external dependencies.  However, certain features require optional packages:

* **`networkx`** – Used for graph operations.  If it is not installed, a lightweight stub is used instead.  Centrality metrics will still function, but some algorithms (e.g. fancy layouts) may be simplified.
* **`pandas`** – Used for reading CSV files in `ReasoningGraph.from_csv`.  Without it, Python’s built‑in `csv` module is used.
* **`pygraphviz` / `matplotlib`** – Used in `scripts/generate_graph.py` to draw images of the graph.  If neither is available, the script writes a text representation of the graph (a `.png.txt` file).  Install one of these packages to enable image generation:

```bash
pip install pygraphviz
# or
pip install matplotlib
```

## Graph rendering fails in CI

If the CI runner cannot install Graphviz or pygraphviz, the `generate_graph.py` script will fall back to using matplotlib or, failing that, to producing a textual representation.  Ensure that the CI workflow installs `graphviz` via `apt` if available.  If this is not possible, adjust the workflow to skip image generation or accept the `.txt` fallback.

## Tests fail unexpectedly

Run the test suite locally with increased verbosity to see detailed error messages:

```bash
make test
```

If a test fails due to a missing dependency, either install the dependency or update the fallback implementation.  For example, the degree centrality implementation in `networkx_stub.py` was tuned so that the sum of centrality scores equals the number of nodes, matching our tests.  Adjustments like this are documented in `docs/proof-log.md`.

## CI/CD fails to deploy Pages

The GitHub Pages workflow downloads the `public` artefact generated by the CI job and deploys it.  Ensure that the CI job correctly populates the `public` directory with your graph (`graph.json` and optional image/text) and report (`report.md`).  If the deploy job fails, inspect the logs for permission issues.  The workflow must have the `pages` and `id-token` permissions enabled.

## Need further help?

If these guidelines do not resolve your issue, please open an issue in the repository with details of your environment, the exact commands run, and any error messages.  Contributions to improve this guide are welcome.